(()=>{var o={n:e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},d:(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(o,e)=>Object.prototype.hasOwnProperty.call(o,e),r:o=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})}},e={};(()=>{"use strict";o.r(e);const t=flarum.core.compat["common/extend"],n=flarum.core.compat["forum/app"];var r=o.n(n);const a=flarum.core.compat["common/components/Button"];var s=o.n(a);const c=flarum.core.compat["common/components/LinkButton"];var u=o.n(c);const i=flarum.core.compat["common/Model"];var l=o.n(i);const d=flarum.core.compat["common/models/Post"];var p=o.n(d);const y=flarum.core.compat["forum/components/UserPage"];var f=o.n(y);const w=flarum.core.compat["forum/components/CommentPost"];var h=o.n(w);const v=flarum.core.compat["forum/utils/PostControls"];var b=o.n(v);const R=flarum.core.compat["common/utils/extractText"];var k=o.n(R);function g(o,e){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,e){return o.__proto__=e,o},g(o,e)}function M(o,e){o.prototype=Object.create(e.prototype),o.prototype.constructor=o,g(o,e)}var A=function(o){function e(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=o.call.apply(o,[this].concat(n))||this).amount=l().attribute("amount"),e.newMoney=l().attribute("newMoney"),e.comment=l().attribute("comment"),e.createdAt=l().attribute("createdAt",l().transformDate),e.post=l().hasOne("post"),e.giver=l().hasOne("giver"),e.receiver=l().hasOne("receiver"),e}return M(e,o),e}(l());const P=flarum.core.compat["common/components/LoadingIndicator"];var C=o.n(P);const O=flarum.core.compat["common/Component"];var x=o.n(O);const F=flarum.core.compat["common/components/Link"];var S=o.n(F);const T=flarum.core.compat["common/helpers/avatar"];var U=o.n(T);const _=flarum.core.compat["common/helpers/humanTime"];var j=o.n(_);const N=flarum.core.compat["common/helpers/icon"];var H=o.n(N);const B=flarum.core.compat["common/helpers/username"];var D=o.n(B),L=function(o){function e(){return o.apply(this,arguments)||this}return M(e,o),e.prototype.view=function(){var o=r().forum.attribute("antoinefr-money.moneyname")||"[money]";return m("span",o.replace("[money]",this.attrs.money+""))},e}(x()),V=function(o){function e(){return o.apply(this,arguments)||this}return M(e,o),e.prototype.view=function(){var o,e=this.attrs,t=e.reward,n=e.showReceiver,a=t.giver()||null,s=t.receiver()||null,c=t.post(),u=[U()(a),D()(a)],i=[U()(s),D()(s)],l=t.comment();return m("li.MoneyRewardRecord",[m("span.MoneyRewardRecordIcon",H()("fas fa-gift")),m("span.MoneyRewardRecordDate",j()(t.createdAt())),m("span.MoneyRewardRecordAmount",L.component({money:t.amount()})),m("span.MoneyRewardRecordGiver",[" ",r().translator.trans("clarkwinkelmann-money-rewards.forum.record.from")," ",a?S().component({className:"MoneyRewardRecordUser",href:r().route.user(a)},u):m("span.MoneyRewardRecordUser",u)]),n?m("span.MoneyRewardRecordReceiver",[" ",r().translator.trans("clarkwinkelmann-money-rewards.forum.record.to")," ",s?S().component({className:"MoneyRewardRecordUser",href:r().route.user(s)},i):m("span.MoneyRewardRecordUser",i)]):null,n&&c?m("span.MoneyRewardRecordPost",[" ",r().translator.trans("clarkwinkelmann-money-rewards.forum.record.post",{number:c.number(),title:(null==(o=c.discussion())?void 0:o.title())||"N/A",a:S().component({href:r().route.post(c)})})]):null,l?m(".MoneyRewardRecordComment",[m("span.MoneyRewardRecordCommentLabel",r().translator.trans("clarkwinkelmann-money-rewards.forum.record.comment"))," ",m("span.MoneyRewardRecordCommentContent",t.comment())]):null])},e}(x()),I=function(o){function e(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=o.call.apply(o,[this].concat(n))||this).loading=!0,e.rewards=[],e}M(e,o);var t=e.prototype;return t.oninit=function(e){o.prototype.oninit.call(this,e),this.loadUser(m.route.param("username"))},t.show=function(e){o.prototype.show.call(this,e),r().setTitle(k()(r().translator.trans("clarkwinkelmann-money-rewards.forum.profile.title"))),this.loadRewards()},t.loadRewards=function(){var o=this;r().request({method:"GET",url:r().forum.attribute("apiUrl")+"/users/"+this.user.id()+"/money-rewards"}).then((function(e){o.rewards=r().store.pushPayload(e),o.loading=!1,m.redraw()}))},t.content=function(){return this.loading?C().component():m("ul.MoneyRewardHistoryPage.MoneyRewardRecords",[this.rewards.map((function(o){return V.component({reward:o,showReceiver:!0})}))])},e}(f());const q=flarum.core.compat["common/components/Modal"];var G=o.n(q);const z=flarum.core.compat["common/components/Switch"];var E=o.n(z),W=function(o){function e(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=o.call.apply(o,[this].concat(n))||this).preselectAmount=0,e.customAmount=!1,e.customAmountValue="",e.createMoney=!1,e.comment="",e}M(e,o);var t=e.prototype;return t.oninit=function(e){o.prototype.oninit.call(this,e),0===(r().forum.attribute("moneyRewardsPreselection")||[]).length&&(this.customAmount=!0)},t.className=function(){return"Modal--small"},t.title=function(){return r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.title")},t.content=function(){var o=this,e=r().forum.attribute("moneyRewardsPreselection")||[];return m(".Modal-body",[m(".Form-group",[r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.target",{number:this.attrs.post.number(),user:this.attrs.post.user()})]),e.length>0?m(".Form-group",[e.map((function(e,t){return m("label",[m("input",{type:"radio",name:"money-reward-preselection",checked:o.preselectAmount===t&&!o.customAmount,onchange:function(){o.preselectAmount=t,o.customAmount=!1}})," ",L.component({money:e})])})),r().forum.attribute("moneyRewardsCustomAmounts")?m("label",[m("input",{type:"radio",name:"money-reward-preselection",checked:this.customAmount,onchange:function(){o.customAmount=!0}})," ",r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.optionCustom")]):null]):null,this.customAmount?m(".Form-group",[m("label",r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.label.custom")),m("input.FormControl",{type:"number",value:this.customAmountValue,onchange:function(e){o.customAmountValue=e.target.value},min:r().forum.attribute("moneyRewardsCustomAmountsMin"),max:r().forum.attribute("moneyRewardsCustomAmountsMax")||void 0,step:1/Math.pow(10,r().forum.attribute("moneyRewardsCustomAmountsDecimals"))})]):"",m(".Form-group",[r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.balance",{amount:L.component({money:r().session.user.attribute("money")})})]),r().forum.attribute("moneyRewardsCreateMoney")?m(".Form-group",[E().component({state:this.createMoney,onchange:function(e){o.createMoney=e}},r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.label.create"))]):null,m(".Form-group",[m("label",r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.label.comment")),m("textarea.FormControl",{value:this.comment,onchange:function(e){o.comment=e.target.value}})]),m(".Form-group",s().component({type:"submit",className:"Button Button--primary",loading:this.loading},r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.submit")))])},t.onsubmit=function(o){var e=this;o.preventDefault(),this.loading=!0,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/posts/"+this.attrs.post.id()+"/money-rewards",errorHandler:this.onerror.bind(this),body:{data:{attributes:{amount:this.customAmount?this.customAmountValue:r().forum.attribute("moneyRewardsPreselection")[this.preselectAmount],createMoney:this.createMoney,comment:this.comment}}}}).then((function(o){r().store.pushPayload(o),e.hide(),r().alerts.show({type:"success"},r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.success"))})).catch((function(){e.loading=!1,m.redraw()}))},e}(G()),J=function(o){function e(){return o.apply(this,arguments)||this}return M(e,o),e.prototype.view=function(){var o=this.attrs.post.moneyRewards();return Array.isArray(o)&&0!==o.length?m(".PostMoneyRewards",[m("h4",r().translator.trans("clarkwinkelmann-money-rewards.forum.post.section")),m("ul.MoneyRewardRecords",o.map((function(o){return V.component({reward:o})})))]):null},e}(x());r().initializers.add("clarkwinkelmann-money-rewards",(function(){r().routes.userMoneyRewardHistory={path:"/u/:username/rewards",component:I},r().store.models["money-rewards"]=A,p().prototype.moneyRewards=l().hasMany("moneyRewards"),(0,t.extend)(f().prototype,"navItems",(function(o){this.user&&this.user.attribute("canSeeMoneyRewardHistory")&&o.add("money-rewards",u().component({href:r().route("userMoneyRewardHistory",{username:this.user.slug()}),icon:"fas fa-money-bill"},r().translator.trans("clarkwinkelmann-money-rewards.forum.profile.nav")))})),(0,t.extend)(b(),"userControls",(function(o,e){e.attribute("rewardWithMoney")?o.add("money-reward",s().component({onclick:function(){r().modal.show(W,{post:e})},icon:"fas fa-gift"},r().translator.trans("clarkwinkelmann-money-rewards.forum.post.action"))):"comment"===e.attribute("contentType")&&r().session.user&&o.add("money-reward",s().component({icon:"fas fa-gift",className:"disabled",onclick:function(){alert(k()(r().translator.trans("clarkwinkelmann-money-rewards.forum.post.disallowed"+(e.user()===r().session.user?"Own":"Other"))))}},r().translator.trans("clarkwinkelmann-money-rewards.forum.post.action")))})),(0,t.extend)(h().prototype,"content",(function(o){o.push(J.component({post:this.attrs.post}))}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map