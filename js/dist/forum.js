(()=>{var t={n:o=>{var n=o&&o.__esModule?()=>o.default:()=>o;return t.d(n,{a:n}),n},d:(o,n)=>{for(var e in n)t.o(n,e)&&!t.o(o,e)&&Object.defineProperty(o,e,{enumerable:!0,get:n[e]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};(()=>{"use strict";t.r(o);const n=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/app"];var r=t.n(e);const a=flarum.core.compat["common/components/Button"];var s=t.n(a);const u=flarum.core.compat["common/components/LinkButton"];var c=t.n(u);const l=flarum.core.compat["common/Model"];var i=t.n(l);const p=flarum.core.compat["common/models/Post"];var d=t.n(p);const f=flarum.core.compat["forum/components/UserPage"];var y=t.n(f);const h=flarum.core.compat["forum/components/CommentPost"];var w=t.n(h);const v=flarum.core.compat["forum/utils/PostControls"];var b=t.n(v);const g=flarum.core.compat["common/utils/extractText"];var k=t.n(g);function A(t,o){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},A(t,o)}function M(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,A(t,o)}var R=function(t){function o(){for(var o,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(o=t.call.apply(t,[this].concat(e))||this).amount=i().attribute("amount"),o.newMoney=i().attribute("newMoney"),o.comment=i().attribute("comment"),o.createdAt=i().attribute("createdAt",i().transformDate),o.post=i().hasOne("post"),o.giver=i().hasOne("giver"),o.receiver=i().hasOne("receiver"),o}return M(o,t),o}(i());const P=flarum.core.compat["common/components/LoadingIndicator"];var O=t.n(P);const C=flarum.core.compat["common/helpers/avatar"];var x=t.n(C);const F=flarum.core.compat["common/helpers/username"];var _=t.n(F);const j=flarum.core.compat["common/helpers/humanTime"];var S=t.n(j);const T=flarum.core.compat["common/Component"];var B=t.n(T),H=function(t){function o(){return t.apply(this,arguments)||this}return M(o,t),o.prototype.view=function(){var t=r().forum.attribute("antoinefr-money.moneyname")||"[money]";return m("span",t.replace("[money]",this.attrs.money+""))},o}(B()),V=function(t){function o(){for(var o,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(o=t.call.apply(t,[this].concat(e))||this).loading=!0,o.rewards=[],o}M(o,t);var n=o.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.loadUser(m.route.param("username"))},n.show=function(o){t.prototype.show.call(this,o),r().setTitle(k()(r().translator.trans("clarkwinkelmann-money-rewards.forum.profile.title"))),this.loadRewards()},n.loadRewards=function(){var t=this;r().request({method:"GET",url:r().forum.attribute("apiUrl")+"/users/"+this.user.id()+"/money-rewards"}).then((function(o){t.rewards=r().store.pushPayload(o),t.loading=!1,m.redraw()}))},n.content=function(){return this.loading?O().component():m("ul.MoneyRewardHistoryPage",[this.rewards.map((function(t){var o=t.giver()||null,n=t.receiver()||null;return m("li",[H.component({money:t.amount()})," from ",x()(o),_()(o)," to ",x()(n),_()(n)," on ",S()(t.createdAt()),m("div",m("em",t.comment()))])}))])},o}(y());const D=flarum.core.compat["common/components/Modal"];var U=t.n(D);const I=flarum.core.compat["common/components/Switch"];var L=t.n(I),N=function(t){function o(){for(var o,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return(o=t.call.apply(t,[this].concat(e))||this).preselectAmount=0,o.customAmount=!1,o.customAmountValue="",o.createMoney=!1,o.comment="",o}M(o,t);var n=o.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),0===(r().forum.attribute("moneyRewardsPreselection")||[]).length&&(this.customAmount=!0)},n.className=function(){return"Modal--small"},n.title=function(){return r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.title")},n.content=function(){var t=this,o=r().forum.attribute("moneyRewardsPreselection")||[];return m(".Modal-body",[m(".Form-group",[r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.target",{number:this.attrs.post.number(),user:this.attrs.post.user()})]),o.length>0?m(".Form-group",[o.map((function(o,n){return m("label",[m("input",{type:"radio",name:"money-reward-preselection",selected:t.preselectAmount===n&&!t.customAmount,onchange:function(){t.preselectAmount=n,t.customAmount=!1}})," ",H.component({money:o})])})),r().forum.attribute("moneyRewardsCustomAmounts")?m("label",[m("input",{type:"radio",name:"money-reward-preselection",selected:this.customAmount,onchange:function(){t.customAmount=!0}})," ",r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.optionCustom")]):null]):null,this.customAmount?m(".Form-group",[m("label",r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.label.custom")),m("input.FormControl",{type:"number",value:this.customAmountValue,onchange:function(o){t.customAmountValue=o.target.value},min:r().forum.attribute("moneyRewardsCustomAmountsMin"),max:r().forum.attribute("moneyRewardsCustomAmountsMax")||void 0,step:1/Math.pow(10,r().forum.attribute("moneyRewardsCustomAmountsDecimals"))})]):"",m(".Form-group",[r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.balance",{amount:H.component({money:r().session.user.attribute("money")})})]),r().forum.attribute("moneyRewardsCreateMoney")?m(".Form-group",[L().component({state:this.createMoney,onchange:function(o){t.createMoney=o}},r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.label.create"))]):null,m(".Form-group",[m("label",r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.label.comment")),m("textarea.FormControl",{value:this.comment,onchange:function(o){t.comment=o.target.value}})]),m(".Form-group",s().component({type:"submit",className:"Button Button--primary",loading:this.loading},r().translator.trans("clarkwinkelmann-money-rewards.forum.modal.submit")))])},n.onsubmit=function(t){t.preventDefault(),r().store.createRecord("money-rewards").save({amount:this.customAmount?this.customAmountValue:r().forum.attribute("moneyRewardsPreselection")[this.preselectAmount],createMoney:this.createMoney,comment:this.comment,relationships:{post:this.attrs.post}}).then((function(t){r().modal.close()}))},o}(U()),q=function(t){function o(){return t.apply(this,arguments)||this}return M(o,t),o.prototype.view=function(){var t=this.attrs.post.moneyRewards();return Array.isArray(t)&&0!==t.length?m("ul.PostMoneyRewards",t.map((function(t){var o=t.giver()||null;return m("li.PostMoneyReward",[H.component({money:t.amount()})," by ",x()(o),_()(o),m("div",m("em",t.comment()))])}))):null},o}(B());r().initializers.add("clarkwinkelmann-money-rewards",(function(){r().routes.userMoneyRewardHistory={path:"/u/:username/rewards",component:V},r().store.models["money-rewards"]=R,d().prototype.moneyRewards=i().hasMany("moneyRewards"),(0,n.extend)(y().prototype,"navItems",(function(t){this.user&&this.user.attribute("canSeeMoneyRewardHistory")&&t.add("money-rewards",c().component({href:r().route("userMoneyRewardHistory",{username:this.user.slug()}),icon:"fas fa-money-bill"},r().translator.trans("clarkwinkelmann-money-rewards.forum.profile.nav")))})),(0,n.extend)(b(),"userControls",(function(t,o){o.attribute("rewardWithMoney")?t.add("money-reward",s().component({onclick:function(){r().modal.show(N,{post:o})},icon:"fas fa-money-bill"},r().translator.trans("clarkwinkelmann-money-rewards.forum.post.action"))):"comment"===o.attribute("type")&&t.add("money-reward",s().component({disabled:!0,icon:"fas fa-money-bill",onclick:function(){alert(k()(r().translator.trans("clarkwinkelmann-money-rewards.forum.post.disallowed")))}},r().translator.trans("clarkwinkelmann-money-rewards.forum.post.action")))})),(0,n.extend)(w().prototype,"content",(function(t){t.push(q.component({post:this.attrs.post}))}))}))})(),module.exports=o})();
//# sourceMappingURL=forum.js.map